<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>東京JP助手 V3.2 穩定版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f8fbff; font-family: -apple-system, sans-serif; }
        .fuji-blue { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .nav-active { color: #1e40af; font-weight: bold; }
        .page { display: none; }
        .page.active { display: block; }
        .day-btn.active { background-color: #1e40af; color: white; border-color: #1e40af; transform: scale(1.05); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .checked-item { text-decoration: line-through; opacity: 0.5; }
    </style>
</head>
<body class="pb-24">

    <div class="fuji-blue text-white p-5 rounded-b-[30px] shadow-lg sticky top-0 z-50">
        <div class="flex justify-between items-center">
            <h1 id="pageTitle" class="text-xl font-black italic uppercase">Itinerary</h1>
            <div class="text-[10px] bg-white/20 px-3 py-1 rounded-full uppercase tracking-widest">Lai Jiun Yau</div>
        </div>
    </div>

    <div id="page-itinerary" class="page active p-4 space-y-4">
        <div class="bg-white rounded-3xl shadow-sm border border-blue-50">
            <div class="flex border-b border-gray-100">
                <button onclick="toggleFlight('go')" id="goBtn" class="flex-1 py-3 text-xs font-bold bg-blue-50 text-blue-600">去程 4/8</button>
                <button onclick="toggleFlight('back')" id="backBtn" class="flex-1 py-3 text-xs font-bold text-gray-400">回程 4/13</button>
            </div>
            <div id="flightCard" class="p-5"></div>
        </div>

        <div class="flex space-x-2 overflow-x-auto py-2 hide-scroll">
            <script>
                const days = [{d:'4/8',n:'D1'},{d:'4/9',n:'D2'},{d:'4/10',n:'D3'},{d:'4/11',n:'D4'},{d:'4/12',n:'D5'},{d:'4/13',n:'D6'}];
                days.forEach((day, i) => {
                    document.write(`<button onclick="switchDay(${i+1})" id="day-btn-${i+1}" class="day-btn flex-shrink-0 w-14 h-14 rounded-2xl border-2 border-gray-100 bg-white text-center flex flex-col justify-center transition-all ${i===0?'active':''}">
                        <span class="text-[9px] font-bold">${day.n}</span><span class="text-[11px]">${day.d}</span>
                    </button>`);
                });
            </script>
        </div>

        <div class="space-y-3">
            <div class="flex justify-between items-center">
                <h2 id="currentDayTitle" class="text-gray-700 font-bold text-sm">DAY 1 行程</h2>
                <button onclick="openTripModal()" class="text-xs bg-blue-600 text-white px-4 py-2 rounded-full font-bold shadow-md">+ 新增行程</button>
            </div>
            <div id="tripList" class="space-y-3 pb-4"></div>
        </div>
    </div>

    <div id="page-tools" class="page p-4 space-y-6">
        <section id="weatherArea"></section>
        <section class="bg-blue-900 text-white p-6 rounded-[2rem] shadow-xl">
            <h2 class="text-xs font-bold mb-5 flex items-center tracking-widest"><i class="fa-solid fa-coins mr-2 text-yellow-400"></i> 匯率計算 (0.211)</h2>
            <div class="space-y-4">
                <div class="bg-white/10 p-4 rounded-2xl flex justify-between items-center">
                    <span class="text-xs text-blue-200">日幣 JPY</span>
                    <input type="number" id="jpyV" oninput="conv('j')" class="bg-transparent text-right text-xl font-bold outline-none w-1/2" placeholder="0">
                </div>
                <div class="bg-white/10 p-4 rounded-2xl flex justify-between items-center">
                    <span class="text-xs text-blue-200">台幣 TWD</span>
                    <input type="number" id="twdV" oninput="conv('t')" class="bg-transparent text-right text-xl font-bold outline-none w-1/2" placeholder="0">
                </div>
            </div>
        </section>
    </div>

    <div id="page-prep" class="page p-4 space-y-6">
        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-50">
            <h2 class="text-gray-700 font-bold text-sm mb-4">行前清單</h2>
            <div class="flex gap-2 mb-4"><input type="text" id="prepIn" class="flex-1 bg-gray-50 p-3 rounded-xl text-xs outline-none" placeholder="項目..."><button onclick="addPrep()" class="bg-blue-600 text-white px-4 rounded-xl text-xs font-bold">加</button></div>
            <ul id="prepList" class="space-y-3"></ul>
        </div>
        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-50">
            <div class="flex bg-gray-50 rounded-xl p-1 mb-4">
                <button onclick="toggleWish('place')" id="wishPlaceBtn" class="flex-1 py-2 text-[11px] font-bold rounded-lg bg-white shadow-sm text-blue-600">想去地點</button>
                <button onclick="toggleWish('buy')" id="wishBuyBtn" class="flex-1 py-2 text-[11px] font-bold text-gray-400">想買清單</button>
            </div>
            <div class="flex gap-2 mb-4"><input type="text" id="wishIn" class="flex-1 bg-gray-50 p-3 rounded-xl text-xs outline-none" placeholder="輸入名稱..."><button onclick="addWish()" class="bg-blue-600 text-white px-4 rounded-xl text-xs font-bold">加</button></div>
            <ul id="wishList" class="space-y-3"></ul>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-100 flex justify-around p-4 z-50">
        <button onclick="switchPage('itinerary')" id="nav-itinerary" class="flex flex-col items-center nav-active"><i class="fa-solid fa-route text-lg"></i><span class="text-[9px] mt-1">行程</span></button>
        <button onclick="switchPage('tools')" id="nav-tools" class="flex flex-col items-center text-gray-300"><i class="fa-solid fa-wand-magic-sparkles text-lg"></i><span class="text-[9px] mt-1">工具</span></button>
        <button onclick="switchPage('prep')" id="nav-prep" class="flex flex-col items-center text-gray-300"><i class="fa-solid fa-heart text-lg"></i><span class="text-[9px] mt-1">願望</span></button>
    </nav>

    <div id="tripModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-8 z-[100] backdrop-blur-sm">
        <div class="bg-white rounded-[2.5rem] w-full p-8 space-y-5 shadow-2xl">
            <h3 class="font-black text-gray-800 text-lg">新增行程</h3>
            <div class="space-y-1"><label class="text-[10px] text-gray-400 ml-2 font-bold uppercase">Location 地點</label><input type="text" id="mName" class="w-full bg-gray-50 p-4 rounded-2xl outline-none text-sm font-bold"></div>
            <div class="flex gap-4">
                <div class="flex-1 space-y-1"><label class="text-[10px] text-gray-400 ml-2 font-bold uppercase">Hour</label><input type="number" id="mH" class="w-full bg-gray-50 p-4 rounded-2xl text-center font-bold" placeholder="12"></div>
                <div class="flex-1 space-y-1"><label class="text-[10px] text-gray-400 ml-2 font-bold uppercase">Min</label><input type="number" id="mM" class="w-full bg-gray-50 p-4 rounded-2xl text-center font-bold" placeholder="00"></div>
            </div>
            <div class="space-y-1"><label class="text-[10px] text-gray-400 ml-2 font-bold uppercase">Transit 交通</label><input type="text" id="mRoute" class="w-full bg-gray-50 p-4 rounded-2xl outline-none text-sm" placeholder="例如: 地鐵、步行"></div>
            <div class="flex gap-3 pt-4"><button onclick="closeTripModal()" class="flex-1 font-bold text-gray-400">取消</button><button onclick="saveTrip()" class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-200">確定新增</button></div>
        </div>
    </div>

    <script>
        let currentDay = 1;
        let currentWishType = 'place';
        const flightData = {
            go: { f: 'TPE', t: 'NRT', timeF: '13:10', timeT: '17:35', termF: '桃園 T1', termT: '成田 T3', code: 'GK 14', dur: '3h 25m' },
            back: { f: 'NRT', t: 'TPE', timeF: '22:40', timeT: '01:30', termF: '成田 T3', termT: '桃園 T1', code: 'GK 11', dur: '3h 50m' }
        };

        function switchPage(p) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.getElementById('page-'+p).classList.add('active');
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('nav-active', 'text-gray-300'));
            document.getElementById('nav-'+p).classList.add('nav-active');
        }

        function toggleFlight(t) {
            const f = flightData[t];
            document.getElementById('goBtn').className = `flex-1 py-3 text-xs font-bold ${t==='go'?'bg-blue-50 text-blue-600':'text-gray-400'}`;
            document.getElementById('backBtn').className = `flex-1 py-3 text-xs font-bold ${t==='back'?'bg-blue-50 text-blue-600':'text-gray-400'}`;
            document.getElementById('flightCard').innerHTML = `
                <div class="flex justify-between items-center text-center">
                    <div><p class="text-2xl font-black text-blue-900">${f.f}</p><p class="text-[9px] text-gray-400">${f.termF}</p><p class="text-[11px] font-bold mt-1 text-blue-600">${f.timeF}</p></div>
                    <div class="flex-1 px-4 flex flex-col items-center">
                        <p class="text-[8px] text-gray-300 font-bold mb-1 italic">${f.dur}</p>
                        <div class="flex items-center w-full"><div class="border-t border-gray-100 flex-1"></div><i class="fa-solid fa-plane text-blue-500 mx-2 text-xs"></i><div class="border-t border-gray-100 flex-1"></div></div>
                        <p class="text-[9px] text-blue-400 font-black mt-1 uppercase tracking-tighter">${f.code}</p>
                    </div>
                    <div><p class="text-2xl font-black text-blue-900">${f.t}</p><p class="text-[9px] text-gray-400">${f.termT}</p><p class="text-[11px] font-bold mt-1 text-blue-600">${f.timeT}</p></div>
                </div>`;
        }

        function switchDay(d) {
            currentDay = d;
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('day-btn-'+d).classList.add('active');
            document.getElementById('currentDayTitle').innerText = `DAY ${d} 行程`;
            renderTrips();
        }

        function openTripModal() { document.getElementById('tripModal').style.display = 'flex'; }
        function closeTripModal() { 
            document.getElementById('mName').value = '';
            document.getElementById('mH').value = '';
            document.getElementById('mM').value = '';
            document.getElementById('mRoute').value = '';
            document.getElementById('tripModal').style.display = 'none'; 
        }
        
        function saveTrip() {
            const name = document.getElementById('mName').value;
            const h = document.getElementById('mH').value.padStart(2, '0');
            const m = document.getElementById('mM').value.padStart(2, '0');
            const route = document.getElementById('mRoute').value;
            if(!name) return;
            const trips = JSON.parse(localStorage.getItem('tokyo_trips_v3') || '{}');
            if(!trips[currentDay]) trips[currentDay] = [];
            trips[currentDay].push({name, time: `${h}:${m}`, route});
            // 排序時間
            trips[currentDay].sort((a,b) => a.time.localeCompare(b.time));
            localStorage.setItem('tokyo_trips_v3', JSON.stringify(trips));
            renderTrips(); closeTripModal();
        }

        function renderTrips() {
            const trips = JSON.parse(localStorage.getItem('tokyo_trips_v3') || '{}')[currentDay] || [];
            const list = document.getElementById('tripList');
            list.innerHTML = trips.map((t, i) => `
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-gray-50 flex items-center gap-5">
                    <div class="text-blue-600 font-black text-xs min-w-[35px]">${t.time}</div>
                    <div class="flex-1 border-l pl-5 border-gray-100">
                        <h4 class="font-bold text-sm text-gray-800">${t.name}</h4>
                        <p class="text-[10px] text-gray-400 mt-1 flex items-center"><i class="fa-solid fa-shoe-prints mr-1 text-[8px]"></i> ${t.route || '未設定交通'}</p>
                    </div>
                    <div class="flex gap-4 items-center">
                        <a href="https://www.google.com/maps/search/${encodeURIComponent(t.name)}" target="_blank" class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 text-xs"><i class="fa-solid fa-location-arrow"></i></a>
                        <button onclick="delTrip(${i})" class="text-red-100"><i class="fa-solid fa-trash-can text-xs"></i></button>
                    </div>
                </div>`).join('');
            if(!trips.length) list.innerHTML = `<div class="text-center py-10"><p class="text-[10px] text-gray-300 font-bold uppercase tracking-widest">No plans yet for day ${currentDay}</p></div>`;
        }

        function delTrip(i) {
            if(!confirm('確定刪除此行程？')) return;
            const trips = JSON.parse(localStorage.getItem('tokyo_trips_v3'));
            trips[currentDay].splice(i, 1);
            localStorage.setItem('tokyo_trips_v3', JSON.stringify(trips));
            renderTrips();
        }

        function toggleWish(t) {
            currentWishType = t;
            document.getElementById('wishPlaceBtn').className = `flex-1 py-2 text-[11px] font-bold rounded-lg ${t==='place'?'bg-white shadow-sm text-blue-600':'text-gray-400'}`;
            document.getElementById('wishBuyBtn').className = `flex-1 py-2 text-[11px] font-bold rounded-lg ${t==='buy'?'bg-white shadow-sm text-blue-600':'text-gray-400'}`;
            renderWishes();
        }
        function addWish() {
            const val = document.getElementById('wishIn').value; if(!val) return;
            const wish = JSON.parse(localStorage.getItem('tokyo_wish_v3') || '{"place":[], "buy":[]}');
            wish[currentWishType].push(val);
            localStorage.setItem('tokyo_wish_v3', JSON.stringify(wish));
            document.getElementById('wishIn').value = ""; renderWishes();
        }
        function renderWishes() {
            const wish = JSON.parse(localStorage.getItem('tokyo_wish_v3') || '{"place":[], "buy":[]}')[currentWishType];
            document.getElementById('wishList').innerHTML = wish.map((w, i) => `
                <li class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                    <span class="text-xs font-bold text-gray-700">${w}</span>
                    <div class="flex gap-4">
                        ${currentWishType==='place' ? `<a href="https://www.google.com/maps/search/${encodeURIComponent(w)}" target="_blank" class="text-blue-300"><i class="fa-solid fa-map-pin"></i></a>` : ''}
                        <button onclick="delWish(${i})" class="text-gray-200"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </li>`).join('');
        }
        function delWish(i) {
            const wish = JSON.parse(localStorage.getItem('tokyo_wish_v3'));
            wish[currentWishType].splice(i, 1);
            localStorage.setItem('tokyo_wish_v3', JSON.stringify(wish));
            renderWishes();
        }

        function addPrep() {
            const val = document.getElementById('prepIn').value; if(!val) return;
            const preps = JSON.parse(localStorage.getItem('tokyo_prep_v3') || '[]');
            preps.push({t: val, d: false});
            localStorage.setItem('tokyo_prep_v3', JSON.stringify(preps));
            document.getElementById('prepIn').value = ""; renderPreps();
        }
        function renderPreps() {
            const preps = JSON.parse(localStorage.getItem('tokyo_prep_v3') || '[]');
            document.getElementById('prepList').innerHTML = preps.map((p, i) => `
                <li class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl ${p.d?'checked-item':''}">
                    <span onclick="togglePrep(${i})" class="text-xs font-bold">${p.t}</span>
                    <button onclick="delPrep(${i})" class="text-gray-200"><i class="fa-solid fa-xmark"></i></button>
                </li>`).join('');
        }
        function togglePrep(i) {
            const p = JSON.parse(localStorage.getItem('tokyo_prep_v3')); p[i].d = !p[i].d;
            localStorage.setItem('tokyo_prep_v3', JSON.stringify(p)); renderPreps();
        }
        function delPrep(i) {
            const p = JSON.parse(localStorage.getItem('tokyo_prep_v3')); p.splice(i, 1);
            localStorage.setItem('tokyo_prep_v3', JSON.stringify(p)); renderPreps();
        }

        function conv(t) {
            const r = 0.211; const j = document.getElementById('jpyV'), tw = document.getElementById('twdV');
            if(t==='j') tw.value = Math.round(j.value * r); else j.value = Math.round(tw.value / r);
        }

        window.onload = () => {
            toggleFlight('go'); renderTrips(); renderWishes(); renderPreps();
            document.getElementById('weatherArea').innerHTML = `
                <h2 class="text-gray-700 font-bold mb-4 text-sm px-1">Weather & Visibility</h2>
                <div class="flex space-x-3 overflow-x-auto pb-4 hide-scroll">
                    ${[{d:'4/8',i:'fa-sun',v:'高'},{d:'4/9',i:'fa-cloud',v:'中'},{d:'4/10',i:'fa-cloud-rain',v:'低'},{d:'4/11',i:'fa-sun',v:'極高'},{d:'4/12',i:'fa-sun',v:'高'},{d:'4/13',i:'fa-cloud-sun',v:'中'}].map(w=>`
                        <div class="bg-white p-5 rounded-[2rem] min-w-[100px] text-center border border-gray-50 shadow-sm">
                            <p class="text-[10px] text-gray-400 font-black uppercase mb-2">${w.d}</p>
                            <i class="fa-solid ${w.i} text-blue-500 text-2xl my-3"></i>
                            <div class="text-[8px] text-blue-600 bg-blue-50 py-1 px-2 rounded-full font-bold uppercase mt-1">Vis: ${w.v}</div>
                        </div>`).join('')}
                </div>`;
        };
    </script>
</body>
</html>
